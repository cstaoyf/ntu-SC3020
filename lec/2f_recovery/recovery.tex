\documentclass{beamer}

\usetheme{Warsaw}
%\usetheme{CambridgeUS}

\input{./def/yf-beamer.tex}
\usepackage{color}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{wrapfig}
\usepackage[skins,breakable]{tcolorbox}

\def\done{\hfill$\square$}
\def\ttt{\texttt}
\def\vgap{\vspace{5mm}}

\def\abt{\ttt{ABORT}}
\def\best{\mit{best}}
\def\cmt{\ttt{COMMIT}}
\def\iddel{ID_\mit{del}}
\def\idins{ID_\mit{ins}}
\def\inp{\ttt{INPUT}}
\def\ins{\ttt{INSERT}}
\def\out{\ttt{OUTPUT}}
\def\rd{\ttt{READ}}
\def\size{\mit{size}}
\def\slock{\ttt{S-LOCK}}
\def\sort{\mit{sort}}
\def\upg{\ttt{UPGRADE}}
\def\ulock{\ttt{U-LOCK}}
\def\unlock{\ttt{UNLOCK}}
\def\wt{\ttt{WRITE}}
\def\xlock{\ttt{X-LOCK}}

\title[DATABASE SYSTEM PRINCIPLES]{Transactions 6:\\ Recovery}

\author[Yufei Tao @ NTU]{Yufei Tao}
\institute[]{\url{https://www.cse.cuhk.edu.hk/~taoyf}}
\date{}

% \def\dtm{\mathit{d\mbox{-}tm}}
% \def\ftm{\mathit{f\mbox{-}tm}}
\def\bestext{\mathit{best\mbox{-}ext}}

\begin{document}
%-------------------------------------------------------------
\begin{frame}
    \titlepage
%     \begin{tcolorbox}[arc=0mm, colframe=green!50!black, colback=green!10!white] 
%     \end{tcolorbox}
\end{frame}
%-------------------------------------------------------------
\begin{frame}
\begin{small}

    \vgap

    Recall:
    \cbox{blue}{
        A \blue{transaction} is a sequence of instructions submitted to a database with the requirement that \bred{either} the entire sequence is executed \bred{or} nothing from the sequence should be executed.
    }
    This is the \blue{all-or-nothing} requirement.

    \vgap

    \cbox{red}{
        \bred{Transactions may fail}. When they do, we must cancel their modifications to the database --- this is known as \blue{recovery}.
    }
    This lecture will introduce several methods for performing recovery in database systems.
\end{small}    
\end{frame}
%-------------------------------------------------------------
\myfrm{

    \cbox{red}{
        A transaction may fail at every statement.
    }

    \cbox{green}{
        \blue{Example 1:}

        \begin{center}
        \begin{tabular}{c|c}
            $\red{T}$ & remark\\
            \hline
            \rd($A$) & read a tuple's value (on some attribute) \\
            \rd($B$) & read a value from another tuple  \\
            $A = A + 1$ &\\
            $B = B - 1$ &\\
            \wt($A$) & update the 1st tuple \\
            \wt($B$) & update the 2nd tuple \\
            \cmt &
        \end{tabular}

        %\vgap
        \end{center}
        \cbox{blue}{
            We must be prepared for the possibility where the power plugged is pull at any moment.
        }

    }
}
%-------------------------------------------------------------
\myfrm{
    \xmybox{Three Copies of the Same Value}

    \cbox{blue}{
    For every value in a database, there can three copies:
    \myitems{
        \item the disk copy;
        \item the (\blue{global}) memory copy of the system;
        \item the (\blue{local}) memory copy of a transaction.
    }
    }

    \begin{center}
        \includegraphics[height=35mm]{./artwork/val-copies}
    \end{center}

}
%-------------------------------------------------------------
\myfrm{
    %\xmybox{Three Copies of the Same Value}

    \cbox{blue}{
    \blue{System-level instructions:}
    \myitems{
        \item $\red{\inp}(A)$: Read the disk copy into the global memory copy.
        \item $\red{\out}(A)$: Write the global memory copy to the disk copy.
    }
    }
    \cbox{blue}{
    \blue{Transaction-level instructions:}
    \myitems{
        \item
        $\red{\rd}(A)$: Read the global memory copy into the local memory copy of a transaction.
    \item
    $\red{\wt}(A)$: Write a transaction's local memory copy to the global memory copy.
    }
    }

    \begin{center}
        \includegraphics[height=25mm]{./artwork/val-copies2}
    \end{center}

}
%-------------------------------------------------------------
\end{document} 



